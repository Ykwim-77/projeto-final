<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100..900;1,100..900&family=Rubik:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="sidebar">
        <div class="logo-container">
            <div class="logo">
                <!-- Substitua pelo caminho correto da sua imagem -->
                <img src="assets/imagens/logoprogestao.png"alt="Logo StockSmart" class="logoTopo">
                <span>ProGest</span>
                <div id="tagline">Gestão Inteligente</div>
            </div>
        </div>
        <hr>
        <div class="menu-container">
            <a routerLink="/home" class="menu-item">
                <i class="fas fa-chart-line"></i>
                <span class="menu-text">Dashboard</span>
            </a>
            <a routerLink="/produtos" class="menu-item active">
                <i class="fas fa-box-open"></i>
                <span class="menu-text">Produtos</span>
            </a>
            <a href="#" class="menu-item">
                <i class="fas fa-exchange-alt"></i>
                <span class="menu-text">Movimentações</span>
            </a>
            <a href="#" class="menu-item">
                <i class="fas fa-chart-bar"></i>
                <span class="menu-text">Relatórios</span>
            </a>
            <a href="#" class="menu-item">
                <i class="fas fa-robot"></i>
                <span class="menu-text">Previsão IA</span>
            </a>
            <a href="#" class="menu-item">
                <i class="fas fa-file-invoice-dollar"></i>
                <span class="menu-text">Planos</span>
            </a>
            <a href="#" class="menu-item">
                <i class="fas fa-cog"></i>
                <span class="menu-text">Configurações</span>
            </a>
            <a href="#" class="menu-item">
                <i class="fas fa-users"></i>
                <span class="menu-text">Usuários</span>
            </a>
        </div>
        <hr>    
        <div class="user-section">
            <div class="user-info">

                <div class="user-avatar">{{ usuarioIniciais || 'U' }}</div>
                <div class="user-details">
                    <div class="user-name">{{ usuarioNome || 'Usuário' }}</div>
                    <div class="user-email">{{ usuarioEmail || 'email@exemplo.com' }}</div>
                </div>
            </div>
            <button class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Sair</span>
            </button>
        </div>
    </nav>

    <main>
        <header class="topo">
            <div class="topo-texto">
                <h1 class="titulo-Topo">Produtos</h1>
                <div class="subtitulo">Gerencie o catálogo do seu estoque</div>
            </div>
            <div class="adicionar-produto-container">
                <div class="adicionar-produto" (click)="abrirCardCadastro()">
                    <i class="fas fa-plus"></i>
                    <div class="adicionar-produto-text">Adicionar Produto</div>
                </div>
            </div>
        </header>

        <section>
            <div class="search-bar">
                <input type="text" placeholder="Pesquisar por nome, sku ou categoria...">
                <i class="fas fa-search"></i>
            </div>
            <div class="botao-opcoes-container">
                <div class="botao-opcoes" 
                     [class.active]="visualizacao === 'grade'" 
                     (click)="mudarVisualizacao('grade')">
                    <div class="adicionar-produto-text">Grade</div>
                </div>
            </div>
            <div class="botao-opcoes-container">
                <div class="botao-opcoes-tabela" 
                     [class.active]="visualizacao === 'tabela'" 
                     (click)="mudarVisualizacao('tabela')">
                    <div class="adicionar-produto-text">Tabela</div>
                </div>
            </div>
        </section> 

                <!-- Lista de Produtos em Grade -->
        <!-- CORREÇÃO NA VISUALIZAÇÃO GRADE -->
        <section *ngIf="visualizacao === 'grade'" class="produtos-grade">
          <div *ngFor="let produto of produtos" class="produto-card">
              <div class="produto-header">
                  <h3>{{ produto.nome || 'Produto sem nome' }}</h3>
                  <span class="produto-categoria">{{ produto.categoria || 'Sem categoria' }}</span>
              </div>
              
              <div class="produto-info">
                  <div class="info-item">
                      <span class="label">SKU:</span>
                      <span class="value">{{ produto.sku || 'N/A' }}</span>
                  </div>
                  <div class="info-item">
                      <span class="label">Preço:</span>
                      <span class="value preco">R$ {{ (produto.preco || 0) | number:'1.2-2' }}</span>
                  </div>
                  <div class="info-item">
                      <span class="label">Estoque:</span>
                      <span class="value quantidade" [class.estoque-baixo]="(produto.quantidade || 0) < 5">
                          {{ produto.quantidade || 0 }} unidades
                      </span>
                  </div>
              </div>

              <div class="produto-actions">
                  <button class="btn-editar" (click)="editarProduto(produto)">
                      <i class="fas fa-edit"></i> Editar
                  </button>
                  <button class="btn-excluir" (click)="excluirProduto(produto.id)">
                      <i class="fas fa-trash"></i> Excluir
                  </button>
              </div>
          </div>
          <div *ngIf="produtos.length === 0" class="sem-produtos">
              <i class="fas fa-box-open"></i>
              <p>Nenhum produto cadastrado</p>
          </div>
        </section>
                <!-- Lista de Produtos em Tabela -->
        <!-- CORREÇÃO NA VISUALIZAÇÃO TABELA -->
        <section *ngIf="visualizacao === 'tabela'" class="tabela-produtos">
          <div class="tabela-container">
            <table class="tabela">
              <thead>
                <tr>
                  <th class="coluna-filtravel">
                    <div class="header-com-filtro">
                      <span class="titulo-coluna">Nome</span>
                      <button class="btn-filtro" (click)="toggleFiltro('nome')">
                        <i class="fas fa-filter"></i>
                      </button>
                      <div class="dropdown-filtro" *ngIf="filtroAberto === 'nome'">
                        <input type="text" 
                              [(ngModel)]="filtros.nome" 
                              placeholder="Buscar por nome..."
                              class="input-filtro">
                        <button class="btn-limpar" (click)="filtros.nome = ''">Limpar</button>
                      </div>
                    </div>
                  </th>
                
                  <th class="coluna-filtravel">
                    <div class="header-com-filtro">
                      <span>SKU</span>
                      <button class="btn-filtro" (click)="toggleFiltro('sku')">
                        <i class="fas fa-filter"></i>
                      </button>
                      <div class="dropdown-filtro" *ngIf="filtroAberto === 'sku'">
                        <input type="text" 
                              [(ngModel)]="filtros.sku" 
                              placeholder="Buscar por SKU..."
                              class="input-filtro">
                        <button class="btn-limpar" (click)="filtros.sku = ''">Limpar</button>
                      </div>
                    </div>
                  </th>
                  
                  <th class="coluna-filtravel">
                    <div class="header-com-filtro">
                      <span>Categoria</span>
                      <button class="btn-filtro" (click)="toggleFiltro('categoria')">
                        <i class="fas fa-filter"></i>
                      </button>
                      <div class="dropdown-filtro" *ngIf="filtroAberto === 'categoria'">
                        <select [(ngModel)]="filtros.categoria" class="select-filtro">
                          <option value="">Todas categorias</option>
                          <option *ngFor="let categoria of categoriasUnicas" [value]="categoria">
                            {{ categoria }}
                          </option>
                        </select>
                        <button class="btn-limpar" (click)="filtros.categoria = ''">Limpar</button>
                      </div>
                    </div>
                  </th>
                  
                  <th class="coluna-filtravel">
                    <div class="header-com-filtro">
                      <span>Preço</span>
                      <button class="btn-filtro" (click)="toggleFiltro('preco')">
                        <i class="fas fa-filter"></i>
                      </button>
                      <div class="dropdown-filtro" *ngIf="filtroAberto === 'preco'">
                        <div class="faixa-preco-filtro">
                          <label>Preço mínimo:</label>
                          <input type="number" 
                                [(ngModel)]="filtros.precoMin" 
                                placeholder="0,00"
                                class="input-filtro-pequeno"
                                min="0">
                          <label>Preço máximo:</label>
                          <input type="number" 
                                [(ngModel)]="filtros.precoMax" 
                                placeholder="10000,00"
                                class="input-filtro-pequeno"
                                min="0">
                        </div>
                        <button class="btn-limpar" (click)="limparFiltroPreco()">Limpar</button>
                      </div>
                    </div>
                  </th>
                  
                  <th class="coluna-filtravel">
                    <div class="header-com-filtro">
                      <span>Estoque</span>
                      <button class="btn-filtro" (click)="toggleFiltro('estoque')">
                        <i class="fas fa-filter"></i>
                      </button>
                      <div class="dropdown-filtro" *ngIf="filtroAberto === 'estoque'">
                        <label>Estoque mínimo:</label>
                        <input type="number" 
                              [(ngModel)]="filtros.estoqueMin" 
                              placeholder="0"
                              class="input-filtro"
                              min="0">
                        <button class="btn-limpar" (click)="filtros.estoqueMin = 0">Limpar</button>
                      </div>
                    </div>
                  </th>
                  
                  <th>Valor Total</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody>
                <tr class="linha-vertical" *ngFor="let produto of produtosFiltrados" 
                    [class.estoque-baixo]="(produto.quantidade || 0) < 5">
                  <td class="nome-produto">
                    <strong>{{ produto.nome || 'Produto sem nome' }}</strong>
                    <small *ngIf="produto.descricao">{{ produto.descricao }}</small>
                  </td>
                  <td class="sku">{{ produto.sku || 'N/A' }}</td>
                  <td class="categoria">
                    <span class="categoria-badge">{{ produto.categoria || 'Sem categoria' }}</span>
                  </td>
                  <td class="preco">R$ {{ (produto.preco || 0) | number:'1.2-2' }}</td>
                  <td class="estoque">
                    <span [class.estoque-critico]="(produto.quantidade || 0) < 5">
                      {{ produto.quantidade || 0 }} unidades
                    </span>
                    <div *ngIf="(produto.quantidade || 0) < 5" class="estoque-alerta">
                      <i class="fas fa-exclamation-triangle"></i>
                      Estoque baixo
                    </div>
                  </td>
                  <td class="valor-total">
                    R$ {{ ((produto.preco || 0) * (produto.quantidade || 0)) | number:'1.2-2' }}
                  </td>
                  <td class="acoes">
                    <button class="btn-acao btn-editar-tabela" 
                            (click)="editarProduto(produto)"
                            title="Editar produto">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-acao btn-excluir-tabela" 
                            (click)="excluirProduto(produto.id)"
                            title="Excluir produto">
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
            
            <div *ngIf="produtosFiltrados.length === 0" class="sem-produtos">
              <i class="fas fa-box-open"></i>
              <p>Nenhum produto encontrado</p>
            </div>
          </div>
        </section>
    </main>
</body>